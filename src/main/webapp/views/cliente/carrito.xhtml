<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                template="/views/newTemplate.xhtml">

    <ui:define name="content">
        <h:outputStylesheet>
            /* Tus estilos originales, sin cambios */
            .modern-cart-container { max-width: 1200px; margin: 0 auto; padding: 20px; font-family: 'Segoe UI', Arial, sans-serif; }
            .cart-header { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; padding: 30px; border-radius: 12px 12px 0 0; text-align: center; margin-bottom: 0; }
            .cart-header h2 { margin: 0 0 10px 0; font-size: 2rem; font-weight: 700; }
            .cart-subtitle { margin: 0; opacity: 0.9; font-size: 1.1rem; }
            .cart-content { background: white; border-radius: 0 0 12px 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; }
            .modern-cart-table { width: 100%; border-collapse: collapse; margin: 0; }
            .modern-cart-table th { background: #f8fafc; padding: 20px 15px; text-align: left; font-weight: 600; color: #1e293b; border-bottom: 2px solid #e2e8f0; }
            .modern-cart-table td { padding: 25px 15px; border-bottom: 1px solid #e2e8f0; vertical-align: middle; }
            .product-cell { display: flex; align-items: center; gap: 15px; }
            .product-image { width: 60px; height: 60px; border-radius: 10px; object-fit: cover; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
            .product-name { font-weight: 600; font-size: 1.1rem; color: #1e293b; margin-bottom: 5px; }
            .product-category { color: #64748b; font-size: 0.9rem; }
            .price-cell { font-weight: 700; font-size: 1.2rem; color: #2563eb; }
            .quantity-controls { display: flex; align-items: center; gap: 10px; }
            .quantity-input { width: 60px; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 6px; text-align: center; font-weight: 600; }
            .btn-update { background: #2563eb; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; }
            .btn-delete { background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; }
            .total-section { padding: 30px; background: #f8fafc; border-top: 1px solid #e2e8f0; text-align: center; }
            .total-amount { font-size: 2.5rem; font-weight: 700; color: #2563eb; margin: 10px 0; }
            .checkout-section { padding: 30px; display: grid; grid-template-columns: 1fr 1fr; gap: 30px; border-top: 1px solid #e2e8f0; }
            .section-title { font-size: 1.3rem; font-weight: 600; color: #1e293b; margin-bottom: 20px; }
            .address-input { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 1rem; }
            .btn-checkout { width: 100%; padding: 16px; background: #2563eb; color: white; border: none; border-radius: 10px; font-size: 1.2rem; font-weight: 600; cursor: pointer; margin-top: 20px; }
            .security-notice { text-align: center; padding: 20px; background: #f8fafc; border-top: 1px solid #e2e8f0; color: #64748b; font-size: 0.9rem; }
        </h:outputStylesheet>

        <div class="modern-cart-container">
            <div class="cart-header">
                <h2>Mi Carrito de Compras</h2>
                <p class="cart-subtitle">Revisa y gestiona tus productos</p>
            </div>

            <div class="cart-content">
                <h:form id="cartForm">
                    <h:messages id="msgs" globalOnly="true" style="color:#10b981; text-align:center; margin:10px 0;"/>

                    <h:dataTable value="#{clienteController.carrito}" var="item" styleClass="modern-cart-table">
                        <h:column>
                            <f:facet name="header">Producto</f:facet>
                            <div class="product-cell">
                                <h:graphicImage value="#{productController.getImageBase64(item.producto)}" styleClass="product-image" />
                                <div>
                                    <div class="product-name">#{item.producto.nombreProducto}</div>
                                    <div class="product-category">Producto fresco</div>
                                </div>
                            </div>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Precio</f:facet>
                            <div class="price-cell">$#{item.precioUnitario}</div>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Cantidad</f:facet>
                            <div class="quantity-controls">
                                <h:commandButton value="−"
                                                 action="#{clienteController.actualizarCantidad(item, item.cantidad - 1)}"
                                                 styleClass="btn-update">
                                    <f:ajax execute="@this" render="@form"/>
                                </h:commandButton>

                                <h:inputText value="#{item.cantidad}" styleClass="quantity-input" readonly="true"/>

                                <h:commandButton value="+"
                                                 action="#{clienteController.actualizarCantidad(item, item.cantidad + 1)}"
                                                 styleClass="btn-update">
                                    <f:ajax execute="@this" render="@form"/>
                                </h:commandButton>
                            </div>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Acción</f:facet>
                            <h:commandButton value="Eliminar"
                                             action="#{clienteController.eliminarDelCarrito(item)}"
                                             styleClass="btn-delete"
                                             onclick="return confirm('¿Estas seguro de eliminar este producto?')">
                                <f:ajax execute="@this" render="@form"/>
                            </h:commandButton>
                        </h:column>
                    </h:dataTable>

                    <div class="total-section">
                        <h3>Total a Pagar</h3>
                        <div class="total-amount">$#{clienteController.total}</div>
                    </div>

                    <div class="checkout-section">
                        <div>
                            <h3 class="section-title">Método de Pago</h3>
                            <div class="payment-options">
                                <h:selectOneRadio value="#{clienteController.metodoPago}">
                                    <f:selectItem itemValue="Nequi" itemLabel="Nequi"/>
                                    <f:selectItem itemValue="Daviplata" itemLabel="Daviplata"/>
                                    <f:selectItem itemValue="ContraEntrega" itemLabel="Contra Entrega"/>
                                </h:selectOneRadio>
                            </div>
                        </div>

                        <div>
                            <h3 class="section-title">Dirección de Entrega</h3>
                            <h:inputText id="direccionEntrega"
                                         value="#{clienteController.direccionEntrega}"
                                         required="true"
                                         requiredMessage="La dirección es obligatoria"
                                         styleClass="address-input"
                                         <placeholder="Ingresa tu dirección completa"/>
                            <h:message for="direccionEntrega" style="color:#ef4444; font-size:0.9rem;"/>
                        </div>
                    </div>

                    <div style="padding: 0 30px 30px;">
                        <h:commandButton value="Finalizar compra"
                                         action="#{clienteController.finalizarCompra()}"
                                         styleClass="btn-checkout">
                            <f:ajax render="msgs"/>
                        </h:commandButton>
                    </div>

                    <div class="security-notice">
                        Compra 100% segura - Tus datos están protegidos
                    </div>
                </h:form>
            </div>
        </div>
    </ui:define>
</ui:composition>
