<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                template="/views/newTemplate.xhtml">

    <ui:define name="content">
        <h:outputStylesheet>
            
        </h:outputStylesheet>

        <div class="catalog-container">
            <div class="catalog-header">
                <h1>Catálogo de Productos</h1>
                <p>Selecciona los productos que deseas agregar al carrito</p>
            </div>

            <!-- FORM PRINCIPAL -->
            <h:form id="catalogForm">
                <!-- Mensajes de confirmación -->
                <h:messages id="catalogMsgs" globalOnly="true"
                            style="color:#10b981; font-weight:600; text-align:center; margin-bottom:10px;" />

                <div class="row g-4">
                    <ui:repeat value="#{clienteController.productos}" var="p">
                        <div class="col-lg-3 col-md-6 col-sm-12">
                            <div class="product-card">
                                <!-- Imagen -->
                                <h:graphicImage value="#{productController.getImageBase64(p)}"
                                                alt="#{p.nombreProducto}"
                                                styleClass="product-image" />

                                <div class="product-body">
                                    <!-- Info básica -->
                                    <div class="product-name">#{p.nombreProducto}</div>
                                    <div class="product-price">$#{p.valorProducto}</div>
                                    <div class="stock-text">Stock: #{p.stockProduccto}</div>

                                    <!-- Controles de cantidad -->
                                    <div class="qty-control">
                                        <h:commandButton value="−"
                                                         action="#{clienteController.decrementarCantidadTemporal(p.idProducto)}"
                                                         styleClass="btn btn-sm btn-light">
                                            <f:ajax execute="@this" render="@form" />
                                        </h:commandButton>

                                        <h:outputText id="cantidad_#{p.idProducto}"
                                                      value="#{clienteController.getCantidadTemporal(p.idProducto)}"
                                                      styleClass="qty-value" />

                                        <h:commandButton value="+"
                                                         action="#{clienteController.incrementarCantidadTemporal(p.idProducto)}"
                                                         styleClass="btn btn-sm btn-light">
                                            <f:ajax execute="@this" render="@form" />
                                        </h:commandButton>
                                    </div>

                                    <!-- Botón agregar -->
                                    <h:commandButton value="Agregar al Carrito"
                                                     action="#{clienteController.agregarAlCarrito(p, clienteController.getCantidadTemporal(p.idProducto))}"
                                                     styleClass="add-btn"
                                                     rendered="#{p.stockProduccto gt 0}">
                                        <f:ajax execute="@this" render="catalogMsgs" />
                                    </h:commandButton>

                                    <h:outputText value="Agotado"
                                                  rendered="#{p.stockProduccto eq 0}"
                                                  style="color:red; font-weight:bold;" />
                                </div>
                            </div>
                        </div>
                    </ui:repeat>
                </div>

                <!-- Si no hay productos -->
                <h:outputText value="No hay productos disponibles en este momento."
                              rendered="#{empty clienteController.productos}"
                              style="display:block;text-align:center;padding:2rem;" />

                <div class="text-center mt-5">
                    <h:commandButton value="Ver Carrito"
                                     action="/views/cliente/carrito.xhtml?faces-redirect=true"
                                     styleClass="btn-carrito" />
                </div>
            </h:form>
        </div>
    </ui:define>
</ui:composition>
