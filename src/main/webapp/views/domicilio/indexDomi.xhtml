<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                template="/views/newTemplate.xhtml">

    <!-- T칤tulo de la p치gina -->
    <ui:define name="title">Gesti칩n de Pedidos</ui:define>

    <!-- Estilos adicionales -->
    <ui:define name="head">
        <style>
            .jsf-data-table th {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                color: white !important;
            }
            .btn-action { margin-right: 5px; }
            .btn-edit { background-color: #4CAF50; color: white; padding: 3px 8px; border-radius: 4px; text-decoration: none; }
            .btn-cancel { background-color: #f44336; color: white; padding: 3px 8px; border-radius: 4px; }
            .action-buttons { display: flex; flex-wrap: wrap; }
            .table-container { overflow-x: auto; margin-top: 20px; }
        </style>
    </ui:define>

    <!-- Contenido principal -->
    <ui:define name="content">
        <!-- Encabezado -->
        <div class="user-header">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                    <h3 class="user-title">
                        <i class="bi bi-basket me-2"></i>Gesti칩n de Pedidos
                    </h3>
                    <p class="domicilio-subtitle">
                        Administra todos los pedidos del sistema
                    </p>
                </div>
                <!--<a href="crearactDomicilio.xhtml" class="btn btn-primary">
                    游 Crear Pedido
                </a> -->
            </div>
        </div>

        <!-- Mensajes del sistema -->
        <h:messages globalOnly="false" styleClass="messages" 
                    infoClass="alert alert-success" 
                    errorClass="alert alert-danger" 
                    warnClass="alert alert-warning"/>

        <!-- Estad칤sticas -->
        <div class="stats-bar mb-3">
            <strong>Total de pedidos: #{clienteController.todosPedidos.size()}</strong>
        </div>

        <!-- Tabla de pedidos -->
        <div class="table-container">
            <table id="pedidosTable" class="jsf-data-table display nowrap" width="100%">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Fecha</th>
                        <th>Direcci칩n</th>
                        <th>Domiciliario</th>
                        <th>Factura</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <ui:repeat value="#{clienteController.todosPedidos}" var="item">
                        <tr>
                            <td><strong>#{item.idPedido}</strong></td>
                            <td>
                                <h:outputText value="#{item.fechaPedido}">
                                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                                </h:outputText>
                            </td>
                            <td>#{item.direccionEntrega}</td>
                            <td>
                                <h:outputText value="#{item.usuarioDomiciliario.nombreUsuario} #{item.usuarioDomiciliario.apellidoUsuario}" 
                                              rendered="#{item.usuarioDomiciliario != null}"/>
                                <h:outputText value="Sin asignar" 
                                              rendered="#{item.usuarioDomiciliario == null}" 
                                              style="color: #999; font-style: italic;"/>
                            </td>
                            <td>
                                <h:outputText value="Factura ##{item.idFactura}" 
                                              rendered="#{item.idFactura != null}"/>
                                <h:outputText value="Sin factura" 
                                              rendered="#{item.idFactura == null}" 
                                              style="color: #999; font-style: italic;"/>
                            </td>
                            <td>
                                <span class="badge 
                                      #{item.estado == 'Entregado' ? 'bg-success' : 
                                        item.estado == 'En camino' ? 'bg-warning' : 
                                        item.estado == 'Pendiente' ? 'bg-info' : 'bg-secondary'}">
                                      #{item.estado}
                                </span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <a href="crearactDomicilio.xhtml?id=#{item.idPedido}" 
                                       class="btn-edit btn-action">
                                        九勇 Editar
                                    </a>
                                    <h:form style="display: inline;">
                                        <h:commandButton value="Cancelar" 
                                                         onclick="return confirm('쮼st치 seguro de cancelar este pedido?')" 
                                                         action="#{clienteController.cancelarPedido(item)}"
                                                         styleClass="btn-cancel btn-action"/>
                                    </h:form>
                                </div>
                            </td>
                        </tr>
                    </ui:repeat>
                </tbody>
            </table>
        </div>

        <!-- Mensaje si no hay pedidos -->
        <div class="alert alert-warning text-center mt-3" rendered="#{empty clienteController.todosPedidos}">
            <h5>No hay pedidos registrados</h5>
            <p>Utiliza el bot칩n "Crear Pedido" para agregar el primer registro.</p>
        </div>

        <!-- DataTables JS -->
        <script>
            $(document).ready(function () {
                $('#pedidosTable').DataTable({
                    "language": {
                        "url": "//cdn.datatables.net/plug-ins/1.10.25/i18n/Spanish.json"
                    },
                    "pagingType": "full_numbers",
                    "responsive": true,
                    "dom": 'Bfrtip',
                    "buttons": [
                        { extend: 'copy', text: '<i class="bi bi-clipboard"></i> Copiar', className: 'btn btn-sm' },
                        { extend: 'csv', text: '<i class="bi bi-file-earmark-spreadsheet"></i> CSV', className: 'btn btn-sm' },
                        { extend: 'excel', text: '<i class="bi bi-file-earmark-excel"></i> Excel', className: 'btn btn-sm' },
                        { extend: 'pdf', text: '<i class="bi bi-file-earmark-pdf"></i> PDF', className: 'btn btn-sm' },
                        { extend: 'print', text: '<i class="bi bi-printer"></i> Imprimir', className: 'btn btn-sm' }
                    ],
                    "initComplete": function (settings, json) {
                        $('.dt-buttons .btn').addClass('me-1');
                    }
                });
            });
        </script>

    </ui:define>
</ui:composition>
