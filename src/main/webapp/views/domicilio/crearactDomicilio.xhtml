<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<body>
    <ui:composition template="./../newTemplate.xhtml">
        
        <ui:define name="title">
            <h:outputText value="#{domicilioController.domicilioSeleccionado == null ? 'Asignar Domicilio' : (empty domicilioController.domicilioSeleccionado.idDomicilio ? 'Asignar Domicilio' : 'Editar Domicilio')}" />
        </ui:define>
        
        <ui:define name="head">
            <style>
                .form-card {
                    background: rgba(255, 255, 255, 0.98);
                    border-radius: 12px;
                    padding: 2rem;
                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
                    border: 1px solid rgba(255, 255, 255, 0.6);
                    margin-bottom: 2rem;
                }
                
                .form-title {
                    color: #2d3748;
                    font-weight: 700;
                    margin-bottom: 0.5rem;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    justify-content: center;
                }
                
                .form-subtitle {
                    color: #718096;
                    font-size: 0.95rem;
                    margin-bottom: 1.5rem;
                    text-align: center;
                }
                
                .form-group {
                    margin-bottom: 1.2rem;
                }
                
                .form-label {
                    display: block;
                    font-weight: 600;
                    color: #2d3748;
                    margin-bottom: 0.4rem;
                    font-size: 0.95rem;
                }
                
                .form-control,
                .form-select {
                    width: 100%;
                    padding: 0.6rem 1rem;
                    border: 1px solid #cbd5e0;
                    border-radius: 8px;
                    font-size: 0.95rem;
                    transition: border-color 0.3s, box-shadow 0.3s;
                    background: white;
                }
                
                .form-control:focus,
                .form-select:focus {
                    outline: none;
                    border-color: #667eea;
                    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
                }
                
                .text-danger {
                    color: #e53e3e;
                    font-size: 0.85rem;
                    margin-top: 0.3rem;
                    display: block;
                }
                
                .text-muted {
                    color: #718096;
                    font-size: 0.85rem;
                    margin-top: 0.3rem;
                    display: block;
                }
                
                .btn-primary-custom {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    border: none;
                    color: white;
                    padding: 0.65rem 1.8rem;
                    border-radius: 10px;
                    font-weight: 600;
                    font-size: 1rem;
                    transition: all 0.3s ease;
                    cursor: pointer;
                }
                
                .btn-primary-custom:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
                }
                
                .btn-secondary-custom {
                    background: #f1f5f9;
                    border: 1px solid #cbd5e0;
                    color: #4a5568;
                    padding: 0.65rem 1.8rem;
                    border-radius: 10px;
                    font-weight: 600;
                    font-size: 1rem;
                    transition: all 0.3s ease;
                    cursor: pointer;
                    text-decoration: none;
                    display: inline-block;
                    text-align: center;
                }
                
                .btn-secondary-custom:hover {
                    background: #e2e8f0;
                    transform: translateY(-1px);
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
                }
                
                .btn-geolocate {
                    background: #f1f5f9;
                    border: 1px solid #cbd5e0;
                    color: #4a5568;
                    padding: 0.6rem 1rem;
                    border-radius: 8px;
                    font-weight: 600;
                    font-size: 0.95rem;
                    transition: all 0.3s ease;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    white-space: nowrap;
                }
                
                .btn-geolocate:hover {
                    background: #e2e8f0;
                    transform: translateY(-1px);
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
                }
                
                .form-actions {
                    display: flex;
                    gap: 1rem;
                    margin-top: 1.5rem;
                    justify-content: center;
                    flex-wrap: wrap;
                }
                
                .form-row {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                    gap: 1.5rem;
                    margin-bottom: 1.5rem;
                }
                
                .address-group {
                    display: flex;
                    gap: 0.75rem;
                    align-items: flex-end;
                }
                
                .address-input {
                    flex: 1;
                    min-width: 0;
                }
                
                @media (max-width: 768px) {
                    .form-card {
                        padding: 1.5rem;
                    }
                    
                    .form-title {
                        font-size: 1.3rem;
                    }
                    
                    .form-actions {
                        flex-direction: column;
                    }
                    
                    .btn-primary-custom,
                    .btn-secondary-custom,
                    .btn-geolocate {
                        width: 100%;
                        justify-content: center;
                    }
                }
            </style>
        </ui:define>
        
        <ui:define name="content">
            <div class="form-card">
                <h2 class="form-title">
                    <i class="bi #{domicilioController.domicilioSeleccionado == null ? 'bi-truck' : (empty domicilioController.domicilioSeleccionado.idDomicilio ? 'bi-truck' : 'bi-pencil-square')}"></i>
                    <h:outputText value="#{domicilioController.domicilioSeleccionado == null ? 'Asignar Domicilio' : (empty domicilioController.domicilioSeleccionado.idDomicilio ? 'Asignar Domicilio' : 'Editar Domicilio')}" />
                </h2>
                <p class="form-subtitle">
                    <h:outputText value="#{domicilioController.domicilioSeleccionado == null ? 
                        'Completa los datos para asignar un nuevo domicilio' : 
                        (empty domicilioController.domicilioSeleccionado.idDomicilio ? 
                            'Completa los datos para asignar un nuevo domicilio' : 
                            'Modifica la informaci贸n del domicilio')}" />
                </p>

                <h:form id="formDomicilio">
                    <h:messages globalOnly="true" 
                                infoStyle="color: #28a745; font-weight: bold; margin-bottom: 1rem; display: block;" 
                                errorStyle="color: #dc3545; font-weight: bold; margin-bottom: 1rem; display: block;" 
                                layout="block"/>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="fechaDomicilio" class="form-label">Fecha *</label>
                            <h:inputText id="fechaDomicilio" 
                                         value="#{domicilioController.domicilioSeleccionado.fechaDomicilio}" 
                                         required="true" 
                                         requiredMessage="La fecha es obligatoria"
                                         styleClass="form-control">
                                <f:convertDateTime pattern="yyyy-MM-dd" />
                            </h:inputText>
                            <small class="text-muted">Formato: AAAA-MM-DD</small>
                            <h:message for="fechaDomicilio" styleClass="text-danger"/>
                        </div>

                        <div class="form-group">
                            <label for="direcccionDomicilio" class="form-label">Direcci贸n *</label>
                            <div class="address-group">
                                <h:inputText id="direcccionDomicilio" 
                                             value="#{domicilioController.domicilioSeleccionado.direcccionDomicilio}" 
                                             required="true" 
                                             requiredMessage="La direcci贸n es obligatoria"
                                             maxlength="200"
                                             styleClass="form-control address-input"/>
                                <h:commandButton 
                                    value=" Geolocalizar" 
                                    action="#{domicilioController.geolocalizarDireccion}"
                                    styleClass="btn-geolocate"
                                    title="Obtener coordenadas de la direcci贸n"/>
                            </div>
                            <h:message for="direcccionDomicilio" styleClass="text-danger"/>
                        </div>

                        <div class="form-group">
                            <label for="estado" class="form-label">Estado *</label>
                            <h:selectOneMenu id="estado" 
                                             value="#{domicilioController.domicilioSeleccionado.estado}" 
                                             required="true" 
                                             requiredMessage="Seleccione el estado"
                                             styleClass="form-select">
                                <f:selectItem itemValue="" itemLabel="Seleccione estado"/>
                                <f:selectItem itemValue="Pendiente" itemLabel="Pendiente" />
                                <f:selectItem itemValue="En camino" itemLabel="En camino" />
                                <f:selectItem itemValue="Entregado" itemLabel="Entregado" />
                            </h:selectOneMenu>
                            <h:message for="estado" styleClass="text-danger"/>
                        </div>

                        <div class="form-group">
                            <label for="facturaTemporal" class="form-label">Factura *</label>
                            <h:selectOneMenu id="facturaTemporal" 
                                             value="#{domicilioController.facturaTemporal}" 
                                             required="true" 
                                             requiredMessage="Seleccione una factura"
                                             styleClass="form-select">
                                <f:selectItem itemValue="" itemLabel="Seleccione factura"/>
                                <f:selectItems value="#{domicilioController.listaFacturas}" 
                                               var="factura" 
                                               itemValue="#{factura.idFactura}" 
                                               itemLabel="Factura ##{factura.idFactura} - #{factura.usuarioIDUSUARIOVENDEDOR.nombreUsuario}"/>
                            </h:selectOneMenu>
                            <h:message for="facturaTemporal" styleClass="text-danger"/>
                        </div>

                        <div class="form-group">
                            <label for="vendedorTemporal" class="form-label">Domiciliario *</label>
                            <h:selectOneMenu id="vendedorTemporal" 
                                             value="#{domicilioController.vendedorTemporal}" 
                                             required="true" 
                                             requiredMessage="Seleccione un domiciliario"
                                             styleClass="form-select">
                                <f:selectItem itemValue="" itemLabel="Seleccione domiciliario"/>
                                <f:selectItems value="#{domicilioController.listaVendedores}" 
                                               var="domiciliario" 
                                               itemValue="#{domiciliario.idUsuario}" 
                                               itemLabel="#{domiciliario.nombreUsuario} #{domiciliario.apellidoUsuario}"/>
                            </h:selectOneMenu>
                            <h:message for="vendedorTemporal" styleClass="text-danger"/>
                        </div>
                    </div>

                    <div class="form-actions">
                        <h:commandButton 
                            value="#{domicilioController.domicilioSeleccionado == null ? 'Asignar Domicilio' : (empty domicilioController.domicilioSeleccionado.idDomicilio ? 'Asignar Domicilio' : 'Actualizar Domicilio')}" 
                            action="#{domicilioController.guardarDomicilio}" 
                            styleClass="btn-primary-custom"/>
                        
                        <h:button 
                            value="Cancelar" 
                            outcome="indexDomi" 
                            styleClass="btn-secondary-custom"/>
                    </div>
                </h:form>
            </div>
        </ui:define>
    </ui:composition>
</body>
</html>
